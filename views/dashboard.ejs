<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/styles/dashboard.css">
</head>
<body>
    <h1>Dashboard</h1>
    <section>
        <h2>Zugriffs-Logs</h2>
        <ul id="access-logs"></ul>
    </section>
    <section>
        <h2>Fehler-Logs</h2>
        <ul id="error-logs"></ul>
    </section>
    <section>
        <h2>Sicherheitsvorf√§lle</h2>
        <ul id="security-logs"></ul>
    </section>
    <section>
        <h2>Logs herunterladen</h2>
        <button onclick="window.location.href='/export-logs/access'">Zugriffs-Logs herunterladen</button>
        <button onclick="window.location.href='/export-logs/errors'">Fehler-Logs herunterladen</button>
        <button onclick="window.location.href='/export-logs/security'">Sicherheits-Logs herunterladen</button>
    </section>
    <section>
        <h2>Fragebogenergebnisse herunterladen</h2>
        <button onclick="window.location.href='/export-survey-results'">Ergebnisse herunterladen</button>
    </section>
    <section>
        <h2>Statistiken</h2>
        <div id="statistics">
            <p>Gesamtantworten: <span id="total-responses"></span></p>
            <ul id="average-ratings"></ul>
        </div>
    </section>
    <section>
        <h2>Ergebnisse filtern</h2>
        <form id="filter-form">
            <label for="company">Firma:</label>
            <input type="text" id="company" name="company">
            
            <label for="department">Abteilung:</label>
            <input type="text" id="department" name="department">
    
            <button type="button" onclick="filterResults()">Filtern</button>
        </form>
        <ul id="filtered-results"></ul>
    </section>
    
    <script>
        function filterResults() {
            const company = document.getElementById('company').value;
            const department = document.getElementById('department').value;
    
            fetch(`/dashboard/results?company=${company}&department=${department}`)
                .then(response => response.json())
                .then(data => {
                    const resultsList = document.getElementById('filtered-results');
                    resultsList.innerHTML = '';
                    data.results.forEach(result => {
                        const listItem = document.createElement('li');
                        listItem.textContent = JSON.stringify(result);
                        resultsList.appendChild(listItem);
                    });
                });
        }
    </script>
    <script>
        fetch('/dashboard/statistics')
            .then((response) => response.json())
            .then((data) => {
                document.getElementById('total-responses').innerText = data.totalResponses;
    
                const ratingsList = document.getElementById('average-ratings');
                Object.entries(data.averageRatings).forEach(([key, value]) => {
                    const listItem = document.createElement('li');
                    listItem.innerText = `${key}: ${value}`;
                    ratingsList.appendChild(listItem);
                });
            })
            .catch(() => {
                document.getElementById('statistics').innerText = 'Fehler beim Laden der Statistiken.';
            });
    </script>
    <script src="/scripts/dashboard.js"></script>
</body>
</html>